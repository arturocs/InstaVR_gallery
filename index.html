<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Insta VR</title>
	<script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script>
	<script src="https://unpkg.com/aframe-look-at-component@0.7.0/dist/aframe-look-at-component.min.js"></script>
</head>

<body>
	<a-scene>
		<a-assets id="assets">
			<img id="sky" src="./sky.jpg">
		</a-assets>
		<a-light type="ambient" color="white"></a-light>
		<a-entity id="anillo-superior">
			<a-image id="im0" position="0 1 -1.5" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im1" position="-1.299 1 -0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im2" position="-1.299 1 0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im3" position="0 1 1.5" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im4" position="1.299 1 -0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im5" position="1.299 1 0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-animation attribute="rotation" from="0 0 0" to="0 360 0" dur="120000" easing="linear" fill="forwards" repeat="indefinite"></a-animation>
		</a-entity>
		<a-entity id="anillo-inferior">
			<a-image id="im6" position="0 2.2 -1.5" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im7" position="-1.299 2.2 -0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im8" position="-1.299 2.2 0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im9" position="0 2.2 1.5" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im10" position="1.299 2.2 -0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-image id="im11" position="1.299 2.2 0.75" src="" visible="false" look-at="#camera">
				<a-plane color="#d3d3d3" height="1.3" width="1.13" position="0 -0.09 -0.1"></a-plane>
			</a-image>
			<a-animation attribute="rotation" from="0 0 0" to="0 -360 0" dur="120000" easing="linear" fill="forwards" repeat="indefinite"></a-animation>
		</a-entity>
		<a-camera id="camera" wasd-controls-enabled="false">
			<a-text id="texto" value="Cargando" position="-0.6 0 -2" width="6" visible="true"></a-text>
		</a-camera>
		<a-sky id="skybox" color="black"></a-sky>
	</a-scene>
</body>

<script>
	var txt = document.querySelector("#texto")
	var fotemp, im, skybox, url
	var fotos, fotos_trim = []
	var usuario = window.location.href.split('?')[1]
	if (usuario !== undefined) {
		url = 'https://www.instagram.com/' + usuario
		const Http = new XMLHttpRequest();
		Http.open("GET", url);
		Http.send();
		Http.onreadystatechange = function () {
			if (this.readyState == 4 && this.status == 200) {
				fotos = Http.responseText.match(/"thumbnail_src":"[^"]*"/g)
				if (fotos !== null) {
					fotos.forEach(function (foto) {
						fotemp = foto.split(':\"')[1]
						fotos_trim.push(fotemp.substring(0, fotemp.length - 1))
					})
					for (var i = 0; i < fotos_trim.length; i++) {
						im = document.querySelector("#im" + i)
						im.setAttribute("src", fotos_trim[i])
						im.setAttribute("visible", "true")
					}
					skybox = document.querySelector("#skybox")
					skybox.setAttribute("color", "white")
					skybox.setAttribute("src", "#sky")
					document.querySelector("#texto").setAttribute("visible", "false")
				} else {
					txt.setAttribute("position", "-0.2 0 -2")
					txt.setAttribute("value", "Error")
				}
			} else {
				txt.setAttribute("position", "-0.2 0 -2")
				txt.setAttribute("value", "Error")
			}
		}
	} else {
		txt.setAttribute("position", "-0.2 0 -2")
		txt.setAttribute("value", "Error")
		console.log("Usuario sin definir")
	}
</script>

</html>